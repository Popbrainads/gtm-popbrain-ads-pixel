___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.

___INFO___

{
  "displayName": "Popbrain Ads Pixel",
  "description": "Track custom events and conversions for Popbrain advertising campaigns. Send event data including page URLs, event names, and custom parameters to optimize your ad performance.",
  "categories": ["MARKETING", "CONVERSION_TRACKING", "ADVERTISING"],
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "type": "TAG",
  "version": 1,
  "brand": {
    "displayName": "Popbrain",
    "id": "popbrain_ads",
    "thumbnail": "data:image/png;base64,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",
  },
  "containerContexts": ["WEB"]
}

___TEMPLATE_PARAMETERS___

[
  {
    "alwaysInSummary": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "displayName": "Event Name",
    "simpleValueType": true,
    "name": "eventName",
    "type": "TEXT",
    "defaultValue": "page_view",
    "help": "Name of the event to track (e.g., page_view, purchase, signup)"
  },
  {
    "alwaysInSummary": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "displayName": "Page URL",
    "simpleValueType": true,
    "name": "pageURL",
    "type": "TEXT",
    "defaultValue": "{{Page URL}}",
    "help": "URL of the page where event occurred"
  },
  {
    "displayName": "Additional Parameters",
    "name": "customParams",
    "type": "SIMPLE_TABLE",
    "help": "Optional custom parameters to send with the event",
    "newRowButtonText": "Add Parameter",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Parameter Name",
        "name": "key",
        "type": "TEXT"
      },
      {
        "defaultValue": "",
        "displayName": "Parameter Value", 
        "name": "value",
        "type": "TEXT"
      }
    ]
  }
]

___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://pixel-tracker-be.vercel.app/*"
              }
            ]
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  }
]

___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const logToConsole = require('logToConsole');
const sendPixel = require('sendPixel');
const encodeUriComponent = require('encodeUriComponent');

// Get template data
const eventName = data.eventName;
const pageURL = data.pageURL;
const customParams = data.customParams || [];

// Base API endpoint
const baseUrl = 'https://pixel-tracker-be.vercel.app/gtm/events';

// Build query parameters
let queryParams = [];

// Add required parameters
if (eventName) {
  queryParams.push('eventName=' + encodeUriComponent(eventName));
}

if (pageURL) {
  queryParams.push('pageURL=' + encodeUriComponent(pageURL));
}

// Add custom parameters if provided
if (customParams && customParams.length > 0) {
  customParams.forEach(function(param) {
    if (param.key && param.value) {
      queryParams.push(encodeUriComponent(param.key) + '=' + encodeUriComponent(param.value));
    }
  });
}

// Construct final URL
const finalUrl = baseUrl + '?' + queryParams.join('&');

// Log for debugging
logToConsole('Popbrain Ads Pixel - Sending event to: ' + finalUrl);

// Send the pixel request
sendPixel(finalUrl, function() {
  // Success callback
  logToConsole('Popbrain Ads Pixel - Event sent successfully');
  data.gtmOnSuccess();
}, function() {
  // Failure callback
  logToConsole('Popbrain Ads Pixel - Pixel request failed');
  logToConsole('Popbrain Ads Pixel - URL attempted: ' + finalUrl);
  data.gtmOnFailure();
});
